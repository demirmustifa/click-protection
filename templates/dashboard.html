<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tıklama Koruma Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .risk-high { color: #dc3545; }
        .risk-medium { color: #ffc107; }
        .risk-low { color: #28a745; }
        .quick-exit-card {
            border-left: 4px solid;
            margin-bottom: 10px;
        }
        .quick-exit-high { border-left-color: #dc3545; }
        .quick-exit-medium { border-left-color: #ffc107; }
        .quick-exit-low { border-left-color: #28a745; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">Tıklama Koruma Sistemi</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- İstatistik Kartları -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Toplam Tıklama</h5>
                        <p class="card-text" id="total-clicks">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Şüpheli Tıklama</h5>
                        <p class="card-text" id="suspicious-clicks">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Hızlı Çıkışlar</h5>
                        <p class="card-text" id="quick-exits">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Şüpheli Oturumlar</h5>
                        <p class="card-text" id="suspicious-sessions">0</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Hızlı Çıkış Raporu -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Hızlı Çıkış Raporu</h5>
                    </div>
                    <div class="card-body">
                        <div id="quick-exit-list" class="overflow-auto" style="max-height: 400px;">
                            <!-- Hızlı çıkış kayıtları buraya eklenecek -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Şüpheli Aktiviteler -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Son Şüpheli Aktiviteler</h5>
                    </div>
                    <div class="card-body">
                        <div id="suspicious-list" class="overflow-auto" style="max-height: 400px;">
                            <!-- Şüpheli aktiviteler buraya eklenecek -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateDashboard() {
            // İstatistikleri güncelle
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('total-clicks').textContent = data.total_clicks;
                    document.getElementById('suspicious-clicks').textContent = data.suspicious_clicks;
                    document.getElementById('quick-exits').textContent = data.quick_exit_total;
                    document.getElementById('suspicious-sessions').textContent = data.suspicious_sessions;
                });

            // Hızlı çıkış raporunu güncelle
            fetch('/api/quick-exit-report')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('quick-exit-list');
                    container.innerHTML = '';

                    data.detailed_sessions
                        .sort((a, b) => b.quick_exit_rate - a.quick_exit_rate)
                        .forEach(session => {
                            const riskClass = session.risk_level === 'Yüksek' ? 'quick-exit-high' :
                                            session.risk_level === 'Orta' ? 'quick-exit-medium' : 'quick-exit-low';
                            
                            const card = document.createElement('div');
                            card.className = `card quick-exit-card ${riskClass}`;
                            card.innerHTML = `
                                <div class="card-body">
                                    <h6 class="card-title">Oturum: ${session.session_id}</h6>
                                    <p class="card-text">
                                        Toplam Tıklama: ${session.total_clicks}<br>
                                        Hızlı Çıkış: ${session.quick_exits}<br>
                                        Risk Seviyesi: <span class="risk-${session.risk_level.toLowerCase()}">${session.risk_level}</span><br>
                                        Son Aktivite: ${new Date(session.last_click).toLocaleString()}
                                    </p>
                                </div>
                            `;
                            container.appendChild(card);
                        });
                });

            // Şüpheli aktiviteleri güncelle
            fetch('/api/suspicious-activities')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('suspicious-list');
                    container.innerHTML = '';

                    data.forEach(activity => {
                        const card = document.createElement('div');
                        card.className = 'card mb-2';
                        card.innerHTML = `
                            <div class="card-body">
                                <h6 class="card-title">${activity.reason}</h6>
                                <p class="card-text">
                                    IP: ${activity.ip}<br>
                                    Zaman: ${new Date(activity.timestamp).toLocaleString()}<br>
                                    ${activity.details ? `Detay: ${activity.details}<br>` : ''}
                                </p>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                });
        }

        // Sayfa yüklendiğinde ve her 30 saniyede bir güncelle
        updateDashboard();
        setInterval(updateDashboard, 30000);
    </script>
</body>
</html> 